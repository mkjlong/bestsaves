<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5th PC bestsaves lookup</title>
    <script src="LOOKUP.js" defer></script>
    <script src="mino-board.js" defer></script>
    <script src="lookuppieces.js" defer></script>
</head>
<body>
    <p id="instructions">
        <button id = hide>hide instructions forever</button>
        <br>
        Input the first two bags (9 pieces) of a valid 5th queue, one per line. 
        <br>
        You can also specify multiple queues using sfinder notation.
        <br>
        Outputs all setups that are bestsaves for all inputted queues.
    </p>
    <p id="text" contenteditable id = "text" style="max-width: 200px; resize:none; overflow: hidden; min-height: 20px; border:2px solid black;font-family: Consolas, 'Courier New', monospace"></p>
    <input type="submit" value="submit" id="submit">
    <br>
    <div id = container style="display: grid;gap:10px;grid:auto-flow / repeat(auto-fill, 200px);padding:20px;margin-top: 10px;">

    </div>
    <script type="module" defer>
        if(localStorage.getItem("hideInstructions")){
            document.getElementById("instructions").style.display = "none";
        }

        document.getElementById("hide").addEventListener("click",function(){
            localStorage.setItem("hideInstructions","true");
            document.getElementById("instructions").style.display = "none";
        })

        document.getElementById("submit").addEventListener("click",function(){
            const a = document.getElementById("text").innerText;
            //console.log(LOOKUP[a]);
            document.getElementById("container").innerHTML = ""
            
            let queues = new Set();
            for(const query of a.split("\n").filter(x=>x.trim())){
                for(const queue of pieces(query)){
                    if(queue.length > 9) continue;
                    const bag1 = normalizedSort(queue.substring(0,2));
                    const bag2 = queue.substring(2);
                    if(bag2.length == 7){
                        queues.add(bag1+bag2);
                    }
                    for(const remaining of pieces(`[^${bag2}]!`)){
                        queues.add(bag1+bag2+remaining)
                    }
                }
            }
            
            queues=[...queues];
            
            let setups = new Set(LOOKUP[queues[0]]);

            for(const queue of queues){
                setups = setups.intersection(new Set(LOOKUP[queue]??[]));
            }
            
            for(const setup of setups){
                const a = document.createElement("a");
                a.href = `./setup-info.html?s=${setup}`;

                const minoBoard = new MinoBoard(setup)

                a.append(minoBoard);
                
                document.getElementById("container").append(a)
            }
            
        })
    </script>
</body>
</html>