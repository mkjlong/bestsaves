<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5th PC bestsaves field lookup</title>
    <script src="LOOKUP.js" defer></script>
    <script src="mino-board.js" defer></script>
    <script src="lookuppieces.js" defer></script>
</head>
<body>
    <p id="text" contenteditable id = "text" style="max-width: 200px; resize:none; overflow: hidden; min-height: 20px; border:2px solid black;font-family: Arial, Helvetica, sans-serif;"></p>
    <input type="submit" value="submit" id="submit">
    <br>
    <div id = container style="display: grid;gap:10px;grid:auto-flow / repeat(auto-fill, 200px);padding:20px;margin-top: 10px;">

    </div>
    <script type="module" defer>
        document.getElementById("submit").addEventListener("click",function(){
            const a = document.getElementById("text").innerText;
            //console.log(LOOKUP[a]);
            document.getElementById("container").innerHTML = ""
            
            let queues = new Set();
            for(const query of a.split("\n")){
                for(const queue of pieces(query)){
                    if(queue.length > 9) continue;
                    const bag1 = normalizedSort(queue.substring(0,2));
                    const bag2 = queue.substring(2);
                    if(bag2.length == 7){
                        queues.add(bag1+bag2);
                    }
                    for(const remaining of pieces(`[^${bag2}]!`)){
                        queues.add(bag1+bag2+remaining)
                    }
                }
            }
            
            queues=[...queues];
            
            let setups = new Set(LOOKUP[queues[0]]);

            for(const queue of queues){
                setups = setups.intersection(new Set(LOOKUP[queue]??[]));
            }
            
            for(const setup of setups){
                const field = Number(setup);
                const fieldString = field.toString(2).padStart(40,"0").match(/.{1,10}/g).map(s=>s.split("").reverse().join("")).join("\n").replaceAll("0","_").replaceAll("1","G");
                const minoBoard = new MinoBoard(fieldString)
                
                document.getElementById("container").append(minoBoard)
            }
            
        })
    </script>
</body>
</html>